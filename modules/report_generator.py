"""
–ú–æ–¥—É–ª—å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∑–≤—ñ—Ç—ñ–≤ (–∑–∞–≥–ª—É—à–∫–∞, –æ—Å–∫—ñ–ª—å–∫–∏ –ª–æ–≥—ñ–∫–∞ –≤–∂–µ –≤ chatbot_module —Ç–∞ energy_calculator)
"""

from datetime import datetime
from typing import Dict

def generate_system_report(data: Dict) -> str:
    """
    –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ –∑–≤—ñ—Ç—É –ø–æ —Å–∏—Å—Ç–µ–º—ñ
    
    Args:
        data: –î–∞–Ω—ñ –¥–ª—è –∑–≤—ñ—Ç—É (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–∞—Ç-–±–æ—Ç–∞ —Ç–∞ –º–æ–≤–Ω–æ–≥–æ –º–æ–¥—É–ª—è)
        
    Returns:
        –¢–µ–∫—Å—Ç –∑–≤—ñ—Ç—É
    """
    bot_stats = data.get('bot', {})
    speech_stats = data.get('speech', {})
    
    report = f"""
    üìã –ó–ê–ì–ê–õ–¨–ù–ò–ô –ó–í–Ü–¢ –°–ò–°–¢–ï–ú–ò
    –î–∞—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó: {datetime.now().strftime('%d.%m.%Y %H:%M:%S')}
    
    ---
    
    ### üí¨ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ß–∞—Ç-–±–æ—Ç–∞
    
    - **–ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—ñ–≤:** {bot_stats.get('total_questions', 0)}
    - **–í—ñ–¥—Å–æ—Ç–æ–∫ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π:** {bot_stats.get('answer_rate', 0):.1f}%
    - **–°–µ—Ä–µ–¥–Ω—ñ–π —á–∞—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:** {bot_stats.get('avg_response_time', 0):.2f} —Å–µ–∫
    - **–¢–æ–ø-5 –ø–∏—Ç–∞–Ω—å:**
    """
    
    for i, (q, count) in enumerate(bot_stats.get('common_questions', {}).items(), 1):
        report += f"  {i}. {q} ({count} —Ä–∞–∑—ñ–≤)\n"
        
    report += f"""
    
    ---
    
    ### üé§ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ú–æ–≤–Ω–æ–≥–æ –ú–æ–¥—É–ª—è
    
    - **TTS –∑–∞–ø–∏—Ç—ñ–≤ (–¢–µ–∫—Å—Ç –≤ –º–æ–≤–ª–µ–Ω–Ω—è):** {speech_stats.get('tts_requests', 0)}
    - **STT –∑–∞–ø–∏—Ç—ñ–≤ (–ú–æ–≤–ª–µ–Ω–Ω—è –≤ —Ç–µ–∫—Å—Ç):** {speech_stats.get('stt_requests', 0)}
    - **–°–∏–Ω—Ç–µ–∑–æ–≤–∞–Ω–æ —Å–∏–º–≤–æ–ª—ñ–≤:** {speech_stats.get('characters_synthesized', 0)}
    - **–ó–∞–≥–∞–ª—å–Ω–∞ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –∞—É–¥—ñ–æ:** {speech_stats.get('audio_duration', 0):.2f} —Å–µ–∫
    
    ---
    
    ### üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó
    
    - –ó–≤—ñ—Ç –ø–æ–∫–∞–∑—É—î –≤–∏—Å–æ–∫—É –∑–∞—Ü—ñ–∫–∞–≤–ª–µ–Ω—ñ—Å—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤. –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è —Ä–æ–∑—à–∏—Ä–∏—Ç–∏ –±–∞–∑—É –∑–Ω–∞–Ω—å FAQ.
    - –°–ª—ñ–¥–∫—É–π—Ç–µ –∑–∞ —á–∞—Å–æ–º –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ, —â–æ–± –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ —à–≤–∏–¥–∫–∏–π –≤—ñ–¥–≥—É–∫.
    
    """
    return report

# –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –∑–≤—ñ—Ç—ñ–≤
def get_report_generator():
    """–û—Ç—Ä–∏–º–∞–Ω–Ω—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –∑–≤—ñ—Ç—ñ–≤"""
    return {
        'generate_system_report': generate_system_report
    }
